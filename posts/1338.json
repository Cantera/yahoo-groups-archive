{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":44728387,"authorName":"David Goodwin","from":"David Goodwin &lt;dgoodwin@...&gt;","profile":"dggoodwin","replyTo":"LIST","senderId":"i1iOZx7X5f_SVH_IWbuR3zxsKGez-7KFfsWqKH8erB27toeUUtXrU188YGj8Dt3DA4A2TI-5DRbNTOB4MiMZokhxvKI27PIhQcNs","spamInfo":{"isSpam":false,"reason":"0"},"subject":"Re: [cantera] Re: Fortran - problem with meanmolarmass()","postDate":"1160783523","msgId":1338,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PDNDQjkyOEYzLUI0RTMtNDA1My1CMTExLUY1NUJFN0ExOTQzMUBjYWx0ZWNoLmVkdT4=","inReplyToHeader":"PGVnb2k0dSsybjZzQGVHcm91cHMuY29tPg==","referencesHeader":"PGVnb2k0dSsybjZzQGVHcm91cHMuY29tPg=="},"prevInTopic":1336,"nextInTopic":0,"prevInTime":1337,"nextInTime":1339,"topicId":1314,"numMessagesInTopic":7,"msgSnippet":"The reason you need to declare it as double precision is that it begins with m (or i ), so Fortran implicitly assumes it is an integer function.  The best","rawEmail":"Return-Path: &lt;dgoodwin@...&gt;\r\nX-Sender: dgoodwin@...\r\nX-Apparently-To: cantera@yahoogroups.com\r\nReceived: (qmail 98290 invoked from network); 13 Oct 2006 23:52:22 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m41.grp.scd.yahoo.com with QMQP; 13 Oct 2006 23:52:22 -0000\r\nReceived: from unknown (HELO outgoing-mail.its.caltech.edu) (131.215.239.19)\n  by mta3.grp.scd.yahoo.com with SMTP; 13 Oct 2006 23:52:21 -0000\r\nReceived: from earth-dog.caltech.edu (earth-dog [192.168.1.3])\n\tby earth-ox-postvirus (Postfix) with ESMTP id 05A00109FE9\n\tfor &lt;cantera@yahoogroups.com&gt;; Fri, 13 Oct 2006 16:52:11 -0700 (PDT)\r\nReceived: from [10.0.1.2] (charter-243-007.caltech.edu [131.215.243.7])\n\t(using TLSv1 with cipher AES128-SHA (128/128 bits))\n\t(No client certificate requested)\n\tby earth-ox.its.caltech.edu (Postfix) with ESMTP id 5B69E10A139\n\tfor &lt;cantera@yahoogroups.com&gt;; Fri, 13 Oct 2006 16:52:06 -0700 (PDT)\r\nMime-Version: 1.0 (Apple Message framework v752.2)\r\nIn-Reply-To: &lt;egoi4u+2n6s@...&gt;\r\nReferences: &lt;egoi4u+2n6s@...&gt;\r\nContent-Type: text/plain; charset=US-ASCII; delsp=yes; format=flowed\r\nMessage-Id: &lt;3CB928F3-B4E3-4053-B111-F55BE7A19431@...&gt;\r\nContent-Transfer-Encoding: 7bit\r\nDate: Fri, 13 Oct 2006 16:52:03 -0700\r\nTo: cantera@yahoogroups.com\r\nX-Mailer: Apple Mail (2.752.2)\r\nX-Spam-Scanned: at Caltech-ITS on earth-dog by amavisd-2.3.3 \r\nX-eGroups-Msg-Info: 1:0:0:0\r\nFrom: David Goodwin &lt;dgoodwin@...&gt;\r\nSubject: Re: [cantera] Re: Fortran - problem with meanmolarmass()\r\nX-Yahoo-Group-Post: member; u=44728387; y=d5Tt1AvVBCxSPht37TZP1LyQNgEpV2M97xFnTRVezU3U\r\nX-Yahoo-Profile: dggoodwin\r\n\r\nThe reason you need to declare it as double precision is that it  \nbegins with &quot;m&quot; (or &quot;i&quot;), so Fortran implicitly assumes it is an  \ninteger function.  The best thing of course is to say &quot;implicit none&quot;  \nand declare everything.\n\nDave\n\n\nOn Oct 13, 2006, at 10:24 AM, Dan Smyth wrote:\n\n&gt; When we added the line below:\n&gt;\n&gt; double precision meanMolarMass, intEnergy_mass\n&gt;\n&gt; to our code, things worked fine for every call.  Was unaware that\n&gt; subroutines calls like this needed to be declared inside Fortran.\n&gt; Thanks for the indirect help.\n&gt;\n&gt; Dan\n&gt;\n&gt;\n&gt; --- In cantera@yahoogroups.com, &quot;Moffat, Harry K&quot; &lt;hkmoffa@...&gt; wrote:\n&gt;&gt;\n&gt;&gt; Hi Mike,\n&gt;&gt;\n&gt;&gt;    When I ran your program, adding the line\n&gt;&gt;       double precision meanMolarMass, intEnergy_mass\n&gt;&gt;\n&gt;&gt; I obtained:\n&gt;&gt;       28.8507043\n&gt;&gt;       -84549.2746\n&gt;&gt;\n&gt;&gt; That must mean there is an issue with your installation, or the make,\n&gt;&gt; make install process didn&#39;t wipe out the old files.\n&gt;&gt;\n&gt;&gt; Best wishes,\n&gt;&gt; Harry\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; Harry Moffat                                             (w) (505)\n&gt;&gt; 844-6912\n&gt;&gt; Multiphase Transport Processes Division    (f)   (505) 844-9297\n&gt;&gt; Sandia National Laboratories\n&gt;&gt; hkmoffa@...\n&gt;&gt; P. O. Box 5800-0834\n&gt;&gt; Albuquerque, NM 87185-0834\n&gt;&gt;\n&gt;&gt; -----Original Message-----\n&gt;&gt; From: cantera@yahoogroups.com [mailto:cantera@yahoogroups.com] On  \n&gt;&gt; Behalf\n&gt;&gt; Of Michael Johnson\n&gt;&gt; Sent: Tuesday, October 03, 2006 2:33 PM\n&gt;&gt; To: cantera@yahoogroups.com\n&gt;&gt; Subject: Re: [cantera] Re: Fortran - problem with meanmolarmass()\n&gt;&gt;\n&gt;&gt; Hi Harry and Dan,\n&gt;&gt;\n&gt;&gt; I checked out and built Cantera from CVS today, but am still getting\n&gt;&gt; very strange results from a simple Fortran example problem:\n&gt;&gt;\n&gt;&gt;        PROGRAM CANTERATEST\n&gt;&gt;        IMPLICIT DOUBLE PRECISION (A-H,O-Z)\n&gt;&gt;        dimension Y(53)\n&gt;&gt;\n&gt;&gt;        DO 10 I=1,53\n&gt;&gt;              Y(I) = 0.0\n&gt;&gt;   10   CONTINUE\n&gt;&gt;\n&gt;&gt;        p = 101325.0\n&gt;&gt;        t = 300.0\n&gt;&gt;        Y(4) = 0.233\n&gt;&gt;        Y(48) = 0.767\n&gt;&gt;\n&gt;&gt;        call newIdealGasMix(&#39;gri30.cti&#39;,&#39;gri30_mix&#39;,&#39;Mix&#39;)\n&gt;&gt;        call setState_TPY(t,p,Y)\n&gt;&gt;\n&gt;&gt;        WRITE(*,30) meanMolarMass()\n&gt;&gt;        WRITE(*,30) intEnergy_mass()\n&gt;&gt;\n&gt;&gt;   30   format(E16.8)\n&gt;&gt;        STOP\n&gt;&gt;        END\n&gt;&gt;\n&gt;&gt; This program returns the following values:\n&gt;&gt;     .00000000E+00\n&gt;&gt;     .45969286E-33\n&gt;&gt;\n&gt;&gt; I compiled demo_ftnlib.cpp and my example program file the same  \n&gt;&gt; way they\n&gt;&gt; are done for the demo.f program included in the distribution\n&gt;&gt; (/usr/local/cantera/templates/f77/), which on my system looks like  \n&gt;&gt; this:\n&gt;&gt;\n&gt;&gt; g++ -c demo_ftnlib.cpp -I/usr/local/cantera/include -O3 -Wall\n&gt;&gt; g77 -c canteratest.f -O3  -fno-second-underscore\n&gt;&gt; g++ -o test canteratest.o demo_ftnlib.o -L/usr/local/cantera/lib\n&gt;&gt; -L/usr/local/lib    -luser -loneD -lzeroD -ltransport -lcantera\n&gt;&gt; -lsundials_cvodes -lsundials_nvecserial -lctlapack -lctblas -lctmath\n&gt;&gt; -ltpx -lctf2c -lconverters -lctcxx  -L/usr/local/lib\n&gt;&gt; -L/usr/lib/gcc-lib/i586-suse-linux/3.3.4\n&gt;&gt; -L/usr/lib/gcc-lib/i586-suse-linux/3.3.4/../../../../i586-suse- \n&gt;&gt; linux/lib\n&gt;&gt; -L/usr/lib/gcc-lib/i586-suse-linux/3.3.4/../../.. -lfrtbegin -lg2c  \n&gt;&gt; -lm\n&gt;&gt; -lgcc_s\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; Why would meanMolarMass() and intEnergy_mass() be returning such  \n&gt;&gt; bogus\n&gt;&gt; numbers?\n&gt;&gt; Thanks,\n&gt;&gt; Michael\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; Moffat, Harry K wrote:\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; Hi Dan,\n&gt;&gt;&gt;\n&gt;&gt;&gt; I have fixed one aspect of this problem within the CVS code.\n&gt;&gt; Previously,\n&gt;&gt;&gt; after initialization, if the mole or mass fractions were not set in\n&gt;&gt; the\n&gt;&gt;&gt; CTI or CTML file within the state XML block, the ThermoPhase object\n&gt;&gt;&gt; would have its mass fraction vector come back from initialization  \n&gt;&gt;&gt; with\n&gt;&gt;&gt; it all set to zeroes. Therefore, the mean molecular weight would\n&gt;&gt; return\n&gt;&gt;&gt; a zero value, until the setstate_TPX() or setstate_TPY() routines  \n&gt;&gt;&gt; were\n&gt;&gt;&gt; called.\n&gt;&gt;&gt;\n&gt;&gt;&gt; I just committed a change to the CVS repository so that species #0\n&gt;&gt; will\n&gt;&gt;&gt; have its mass fraction set to 1.0 at initialization but before  \n&gt;&gt;&gt; Cantera\n&gt;&gt;&gt; handles the state XML block information. Therefore, the mass  \n&gt;&gt;&gt; fraction\n&gt;&gt;&gt; vector should sum to one from the get-go.\n&gt;&gt;&gt;\n&gt;&gt;&gt; I hope the problems you are seeing will be fixed by this. However, I\n&gt;&gt;&gt; would be very interested to know if this is not the case.\n&gt;&gt;&gt; meanMolarMass() is just a wrapper around the kernel routine,\n&gt;&gt;&gt; State::meanMolecularWeight(), in the State object. Cantera&#39;s\n&gt;&gt; independent\n&gt;&gt;&gt; variables are density, temperature, and the mass fraction vector.  \n&gt;&gt;&gt; The\n&gt;&gt;&gt; mean molecular weight is calculated whenever the mass fraction  \n&gt;&gt;&gt; vector\n&gt;&gt; is\n&gt;&gt;&gt; changed. Then, the meanMolecularWeight() function just reports the\n&gt;&gt;&gt; number. Setting the temperature or the density (or equivalently the\n&gt;&gt;&gt; pressure) shouldn&#39;t affect the internally calculated\n&gt;&gt; meanMolecularWeight\n&gt;&gt;&gt; value.\n&gt;&gt;&gt;\n&gt;&gt;&gt; Best wishes,\n&gt;&gt;&gt; Harry\n&gt;&gt;&gt;\n&gt;&gt;&gt; Harry Moffat (w) (505)\n&gt;&gt;&gt; 844-6912\n&gt;&gt;&gt; Multiphase Transport Processes Division (f) (505) 844-9297\n&gt;&gt;&gt; Sandia National Laboratories\n&gt;&gt;&gt; hkmoffa@... &lt;mailto:hkmoffa%40sandia.gov&gt;\n&gt;&gt;&gt; P. O. Box 5800-0834\n&gt;&gt;&gt; Albuquerque, NM 87185-0834\n&gt;&gt;&gt;\n&gt;&gt;&gt; -----Original Message-----\n&gt;&gt;&gt; From: cantera@yahoogroups.com &lt;mailto:cantera%40yahoogroups.com&gt;\n&gt;&gt;&gt; [mailto:cantera@yahoogroups.com &lt;mailto:cantera% \n&gt;&gt;&gt; 40yahoogroups.com&gt;] On\n&gt;&gt;\n&gt;&gt;&gt; Behalf\n&gt;&gt;&gt; Of Dan Smyth\n&gt;&gt;&gt; Sent: Friday, September 29, 2006 4:08 PM\n&gt;&gt;&gt; To: cantera@yahoogroups.com &lt;mailto:cantera%40yahoogroups.com&gt;\n&gt;&gt;&gt; Subject: [cantera] Re: Fortran - problem with meanmolarmass()\n&gt;&gt;&gt;\n&gt;&gt;&gt; Hey Michael,\n&gt;&gt;&gt;\n&gt;&gt;&gt; An associate and I are trying to replace Chemkin calls, within a\n&gt;&gt;&gt; developed Fortran code, with Cantera calls through the demo_lib.cpp\n&gt;&gt;&gt; interface as a guide. We have been having some trouble with the\n&gt;&gt;&gt; meanmolarmass() call. Sometimes it will work and other times it will\n&gt;&gt;&gt; not. (When it will not work, the code will return a segmentation  \n&gt;&gt;&gt; fault\n&gt;&gt;&gt; within our Fortran code when the value returned is printed out).\n&gt;&gt;&gt; We are guessing at this point that there is some conflict that we  \n&gt;&gt;&gt; have\n&gt;&gt;&gt; not found yet that makes this call work intermittently. It does work\n&gt;&gt; at\n&gt;&gt;&gt; points in our code though, and so we think that this is a coding  \n&gt;&gt;&gt; issue\n&gt;&gt;&gt; on our side and not a Cantera issue.\n&gt;&gt;&gt;\n&gt;&gt;&gt; Dan Smyth\n&gt;&gt;&gt;\n&gt;&gt;&gt; --- In cantera@yahoogroups.com &lt;mailto:cantera%40yahoogroups.com&gt;,\n&gt;&gt;&gt; Michael Johnson &lt;johns3c@&gt; wrote:\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; Dear Cantera group,\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; I am working on channel-flow simulations with DASSL, coupled to\n&gt;&gt;&gt; Cantera.\n&gt;&gt;&gt;&gt; The command meanmolarmass() returns a value of 0.0000E+00 but if I\n&gt;&gt;&gt;&gt; take the ratio of, say, cp_mole()/cp_mass() it does return the\n&gt;&gt; proper\n&gt;&gt;&gt; value.\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; I&#39;m running on Linux, using the demo_ftnlib.cpp provided with the\n&gt;&gt;&gt; source\n&gt;&gt;&gt;&gt; code. I have looked through the header files under\n&gt;&gt;&gt;&gt; /usr/local/include/cantera but have been unable to find where\n&gt;&gt;&gt;&gt; meanMolecularWeight() is defined. It is certainly used to calculate\n&gt;&gt;&gt;&gt; molar properties with no problem, but I can&#39;t figure out why\n&gt;&gt;&gt;&gt; meanmolarmass() is not giving the proper value.\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;&gt; Is anyone out there using Cantera in Fortran?\n&gt;&gt;&gt;&gt; Thanks,\n&gt;&gt;&gt;&gt; Michael\n&gt;&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; Yahoo! Groups Links\n&gt;&gt;&gt;\n&gt;&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; Yahoo! Groups Links\n&gt;&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt;\n\n\n"}}